# Tennis Rules RAG í†µí•© ê³„íšì„œ

## Tennis_Rules_RAG â†’ Tennis Mate í†µí•© ì½”ë”© ê³„íš

> **ì‘ì„±ì¼**: 2026-02-07 (ê²€í†  ë°˜ì˜: 2026-02-08)
> **ëª©ì **: ë…ë¦½ì ìœ¼ë¡œ ì„±ê³µí•œ Tennis_Rules_RAG ì‹œìŠ¤í…œì„ Tennis Mate ì•±ì— ì™„ì „íˆ í†µí•©
> **ì›ì¹™**: ì½”ë“œ ì¤‘ë³µ ìµœì†Œí™”, ê¸°ì¡´ ì•„í‚¤í…ì²˜ ì¡´ì¤‘, ì ì§„ì  í†µí•©

---

## 0. ê²€í†  ê²°ê³¼ (2026-02-08 ì¶”ê°€)

Tennis_Rules_RAG ë ˆí¬ì§€í† ë¦¬ë¥¼ í´ë¡ í•˜ì—¬ ì‹¤ì œ ì½”ë“œë¥¼ ë¶„ì„í•œ ê²°ê³¼,
**ê¸°ì¡´ ê³„íšì—ì„œ ìˆ˜ì •ì´ í•„ìš”í•œ 4ê°€ì§€ í•µì‹¬ ì‚¬í•­**ì„ ë°œê²¬í–ˆìŠµë‹ˆë‹¤.

### ê²€í†  1: ì˜ë¬¸ PDF í˜¸í™˜ì„± ë¶„ì„

#### ì‹¤ì œ ETL íŒŒì´í”„ë¼ì¸ (155ê°œ í•œê¸€ ë ˆì½”ë“œë¥¼ ìƒì„±í•œ ê³¼ì •)

ê¸°ì¡´ ê³„íšì—ì„œ ê°€ì •í–ˆë˜ ê²ƒê³¼ ë‹¤ë¥´ê²Œ, **ì‹¤ì œ ë°ì´í„° ì ì¬ëŠ” 3ë‹¨ê³„ íŒŒì´í”„ë¼ì¸**ì´ì—ˆìŠµë‹ˆë‹¤:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ì‹¤ì œ ETL íŒŒì´í”„ë¼ì¸ (Tennis_Rules_RAGì—ì„œ 155ê°œ KTA ë ˆì½”ë“œ ìƒì„±)          â”‚
â”‚                                                                         â”‚
â”‚  Step 1: extract_pdf_gemini.py                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚ í…Œë‹ˆìŠ¤ê·œì •ì§‘.pdf   â”‚â”€â”€â”€â”€â–¶â”‚ Gemini Flash API          â”‚                  â”‚
â”‚  â”‚ (í•œê¸€ PDF)        â”‚     â”‚ (PDF ì—…ë¡œë“œ â†’ í…ìŠ¤íŠ¸ ì¶”ì¶œ) â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                     â”‚ ë§ˆí¬ë‹¤ìš´ í˜•ì‹ì˜ í…ìŠ¤íŠ¸                â”‚
â”‚                                     â–¼                                   â”‚
â”‚  Step 2: gen_sql_from_txt.py  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚ full_rules_text   â”‚                      â”‚
â”‚  â”‚ ì •ê·œì‹ìœ¼ë¡œ ì¡°í•­ ë¶„í•    â”‚â—€â”€â”€â”€â”€â”‚ .txt (208KB)      â”‚                      â”‚
â”‚  â”‚ + gemini-embedding-   â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚  â”‚   001 ì„ë² ë”© ìƒì„±     â”‚                                               â”‚
â”‚  â”‚ + SQL INSERTë¬¸ ì¶œë ¥   â”‚                                               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                               â”‚
â”‚            â”‚                                                            â”‚
â”‚            â–¼                                                            â”‚
â”‚  Step 3: upload_rules.py     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚ insert_rules.sql  â”‚                       â”‚
â”‚  â”‚ SQL íŒŒì‹± â†’ Supabase  â”‚â—€â”€â”€â”€â”‚ (2.8MB, 155ê±´)    â”‚                       â”‚
â”‚  â”‚ ë°°ì¹˜ INSERT           â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                               â”‚
â”‚                                                                         â”‚
â”‚  âš ï¸ etl_tennis_supabase.pyëŠ” ëŒ€ì•ˆ íŒŒì´í”„ë¼ì¸ìœ¼ë¡œ, ì‹¤ì œ ì‚¬ìš©ë˜ì§€ ì•Šì•˜ìŒ      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ì˜ë¬¸ PDF (`2026-rules-of-tennis-english.pdf`) ì²˜ë¦¬ ê°€ëŠ¥ ì—¬ë¶€

| ë‹¨ê³„ | íŒŒì¼ | í˜¸í™˜ì„± | ìˆ˜ì • ë‚´ìš© | ê·œëª¨ |
|------|------|--------|----------|------|
| Step 1 | `extract_pdf_gemini.py` | âš ï¸ ìˆ˜ì • í•„ìš” | PDF ê²½ë¡œ ë³€ê²½ + í”„ë¡¬í”„íŠ¸ ì˜ì–´í™” | ì†Œ |
| Step 2 | `gen_sql_from_txt.py` | âš ï¸ ìˆ˜ì • í•„ìš” | ì •ê·œì‹ íŒ¨í„´ 3ê³³ ìˆ˜ì • | ì¤‘ |
| Step 3 | `upload_rules.py` | âœ… ê·¸ëŒ€ë¡œ ì‚¬ìš© | ì—†ìŒ | ì—†ìŒ |

**Step 1 ìƒì„¸** - `extract_pdf_gemini.py`:
- íŒŒì¼ ê²½ë¡œ: `./í…Œë‹ˆìŠ¤ê·œì •ì§‘(...)` â†’ `./2026-rules-of-tennis-english.pdf`
- í”„ë¡¬í”„íŠ¸(line 34): í•œêµ­ì–´ ì „ìš© â†’ ì˜ì–´ ë˜ëŠ” bilingual ë³€ê²½ í•„ìš”
- Gemini ì¶œë ¥ í˜•ì‹ì´ `**1. THE COURT**` vs `**Rule 1. THE COURT**`ì¸ì§€ëŠ” ì‹¤í–‰ í›„ í™•ì¸ í•„ìš”

**Step 2 ìƒì„¸** - `gen_sql_from_txt.py` ì •ê·œì‹ ë¬¸ì œ 3ê³³:

```
ë¬¸ì œì  1 - start_marker (line 26):
  í˜„ì¬: r"(\*\*1\.\s*ì½”íŠ¸|\*\*ITF\s*í…Œë‹ˆìŠ¤\s*ë£°\*\*)"
                          ^^^^ í•œêµ­ì–´ í•˜ë“œì½”ë”©
  í•„ìš”: ì˜ë¬¸ íŒ¨í„´ ì¶”ê°€ (THE COURT, ITF Rules ë“±)

ë¬¸ì œì  2 - body_split_pattern (line 42-45):
  í˜„ì¬ ë§¤ì¹­ ê°€ëŠ¥:
    âœ… **1. THE COURT**     â†’ \d+\. ë§¤ì¹­
    âœ… **I. Appendix**      â†’ [I-V]+\. ë§¤ì¹­
    âœ… **a. Standard Game** â†’ [A-Z]\. ë§¤ì¹­ (IGNORECASE)
  ë§¤ì¹­ ë¶ˆê°€:
    âŒ **Rule 1 - THE COURT** â†’ "Rule" ë’¤ ìˆ«ì+ë§ˆì¹¨í‘œ íŒ¨í„´ ë¶ˆì¼ì¹˜
  negative lookahead: í•œêµ­ì–´ë§Œ (í˜ì´ì§€, ëª©ì°¨ ë“±) â†’ Page, Contents ì¶”ê°€ í•„ìš”

ë¬¸ì œì  3 - INSERTë¬¸ (line 133):
  í˜„ì¬: INSERT INTO tennis_rules (source_file, rule_id, content, embedding)
  ëˆ„ë½: metadata ì»¬ëŸ¼ ì—†ìŒ â†’ NULLë¡œ ì‚½ì…ë¨
```

**ê¶Œì¥ ì ‘ê·¼**: `extract_pdf_gemini.py`ë¥¼ ì˜ë¬¸ PDFì— DRY RUN â†’ Gemini ì¶œë ¥ í˜•ì‹ í™•ì¸ â†’ ì •ê·œì‹ ì¡°ì •

---

### ê²€í†  2: metadata JSONB ì±„ìš°ê¸°

#### ì›ì¸

`gen_sql_from_txt.py` line 133ì˜ INSERTë¬¸ì— `metadata` ì»¬ëŸ¼ì´ **í¬í•¨ë˜ì§€ ì•ŠìŒ**:
```sql
-- gen_sql_from_txt.pyê°€ ìƒì„±í•˜ëŠ” SQL (metadata ëˆ„ë½!)
INSERT INTO tennis_rules (source_file, rule_id, content, embedding) VALUES (...);
```

ì°¸ê³ ë¡œ `etl_tennis_supabase.py` line 251ì—ëŠ” í¬í•¨ë˜ì–´ ìˆìœ¼ë‚˜, ì´ ìŠ¤í¬ë¦½íŠ¸ëŠ” ì‹¤ì œ ì ì¬ì— ì‚¬ìš©ë˜ì§€ ì•Šì•˜ìŒ:
```python
"metadata": {"original_len": len(item.get("original_content", ""))}
```

#### ìˆ˜ì • ë°©ë²•

**ë°©ë²• A: ê¸°ì¡´ 155ê°œ ë ˆì½”ë“œ ì¦‰ì‹œ ì—…ë°ì´íŠ¸ (SQL 1íšŒ ì‹¤í–‰)**
```sql
UPDATE tennis_rules
SET metadata = jsonb_build_object(
  'language', 'ko',
  'source_version', 'KTA 2020.11.20',
  'original_len', length(content),
  'section_type', CASE
    WHEN rule_id = 'Foreword/Intro' THEN 'foreword'
    WHEN rule_id ~ '^[0-9]+\.' THEN 'rule'
    WHEN rule_id ~ '^[a-zA-Z]\.' THEN 'sub-section'
    WHEN rule_id ~ '^(ë¶€ë¡|Appendix|[IVX]+\.)' THEN 'appendix'
    ELSE 'other'
  END
)
WHERE metadata IS NULL;
```

**ë°©ë²• B: `gen_sql_from_txt.py` ìˆ˜ì • (í–¥í›„ ETL)**
- INSERTë¬¸ì— metadata ì»¬ëŸ¼ ì¶”ê°€
- ì²­í‚¹ ì‹œ ë©”íƒ€ë°ì´í„° ìˆ˜ì§‘ (ì–¸ì–´, ì„¹ì…˜ ìœ í˜•, ë¶€ëª¨ ì¡°í•­ ë“±)

#### ê¶Œì¥ metadata êµ¬ì¡°
```json
{
  "language": "ko",
  "source_version": "KTA 2020.11.20",
  "section_type": "rule | sub-section | appendix | foreword",
  "parent_rule": "5. ê²Œì„ ìŠ¤ì½”ì–´",
  "original_len": 1234
}
```

**ê²°ë¡ **: âœ… ìˆ˜ì • ê°€ëŠ¥. SQL UPDATEë¡œ ê¸°ì¡´ ë°ì´í„° ì¦‰ì‹œ ë³´ì™„ ê°€ëŠ¥ + ETL ì½”ë“œ ìˆ˜ì •ìœ¼ë¡œ í–¥í›„ ìë™ í¬í•¨

---

### ê²€í†  3: ì„ë² ë”© ëª¨ë¸ ë¶ˆì¼ì¹˜ (Critical)

#### ë°œê²¬ëœ ë¶ˆì¼ì¹˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     âš ï¸ ì„ë² ë”© ëª¨ë¸ ë¶ˆì¼ì¹˜ ë°œê²¬                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  Tennis_Rules_RAG (ì‹¤ì œ ë°ì´í„° ìƒì„± + ì§ˆì˜)                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚  â”‚ ETL: gen_sql_from_txt.py           â”‚                              â”‚
â”‚  â”‚   model = "gemini-embedding-001"   â”‚ â—„â”€â”€ ë°ì´í„° ì„ë² ë”©             â”‚
â”‚  â”‚                                    â”‚                              â”‚
â”‚  â”‚ Edge Fn: tennis-rag-query/index.ts â”‚                              â”‚
â”‚  â”‚   model = "gemini-embedding-001"   â”‚ â—„â”€â”€ ì§ˆì˜ ì„ë² ë”© (ë§¤ì¹­ âœ…)     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â”‚                                                                      â”‚
â”‚  Tennis Mate (í˜„ì¬ ì½”ë“œ)                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚  â”‚ Edge Fn: search-tennis-rules       â”‚                              â”‚
â”‚  â”‚   model = "text-embedding-004"     â”‚ â—„â”€â”€ ì§ˆì˜ ì„ë² ë”© (ë¶ˆì¼ì¹˜ âŒ)   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â”‚                                                                      â”‚
â”‚  ì˜í–¥: Tennis Mate Edge Functionìœ¼ë¡œ ì§ˆì˜ ì‹œ                           â”‚
â”‚        text-embedding-004 ë²¡í„° â‰  gemini-embedding-001 ë²¡í„°            â”‚
â”‚        â†’ ìœ ì‚¬ë„ ê²€ìƒ‰ ê²°ê³¼ê°€ ë¶€ì •í™•í•  ìˆ˜ ìˆìŒ                             â”‚
â”‚                                                                      â”‚
â”‚  í•´ê²°: Tennis Mate Edge Functionì˜ ëª¨ë¸ì„                              â”‚
â”‚        gemini-embedding-001ë¡œ í†µì¼ í•„ìš”                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### DB ìŠ¤í‚¤ë§ˆ ì°¨ì´ (ì‹¤ì œ Supabase vs Tennis Mate ì½”ë“œ)

ìŠ¤í¬ë¦°ìƒ· í™•ì¸ ê²°ê³¼, **ì‹¤ì œ Supabase DBëŠ” Tennis_Rules_RAG ìŠ¤í‚¤ë§ˆ**ë¥¼ ì‚¬ìš© ì¤‘:

| ì»¬ëŸ¼ | ì‹¤ì œ DB (RAG ìŠ¤í‚¤ë§ˆ) | Tennis Mate migration | ìƒíƒœ |
|------|---------------------|----------------------|------|
| id | âœ… BIGSERIAL | âœ… BIGSERIAL | ë™ì¼ |
| source_file | âœ… TEXT | âœ… TEXT | ë™ì¼ |
| rule_id | âœ… TEXT | âŒ ì—†ìŒ | **ë¶ˆì¼ì¹˜** |
| title | âŒ ì—†ìŒ | âœ… TEXT | **ë¶ˆì¼ì¹˜** |
| content | âœ… TEXT | âœ… TEXT | ë™ì¼ |
| language | âŒ ì—†ìŒ | âœ… VARCHAR(2) | **ë¶ˆì¼ì¹˜** |
| chunk_index | âŒ ì—†ìŒ | âœ… INTEGER | **ë¶ˆì¼ì¹˜** |
| metadata | âœ… JSONB | âŒ ì—†ìŒ | **ë¶ˆì¼ì¹˜** |
| embedding | âœ… VECTOR(768) | âœ… VECTOR(768) | ë™ì¼ |
| updated_at | âŒ ì—†ìŒ | âœ… TIMESTAMPTZ | **ë¶ˆì¼ì¹˜** |

**ì˜í–¥**: Tennis Mate Edge Functionì´ `title`, `language`, `chunk_index` ì»¬ëŸ¼ì„ ì°¸ì¡°í•˜ë©´ ì—ëŸ¬ ë°œìƒ
**í•´ê²°**: Edge Functionê³¼ RPC í•¨ìˆ˜ë¥¼ ì‹¤ì œ DB ìŠ¤í‚¤ë§ˆì— ë§ì¶° ìˆ˜ì • í•„ìš”

---

### ê²€í†  4: Frontend ETL Plan

#### í˜„ì¬ ETLì˜ ë¶ˆí¸í•¨

```
í˜„ì¬: Python CLI â†’ 5ë‹¨ê³„ ìˆ˜ë™ ì‹¤í–‰
  1. extract_pdf_gemini.py ì‹¤í–‰ (PDF â†’ txt)     â† í„°ë¯¸ë„ í•„ìš”
  2. gen_sql_from_txt.py ì‹¤í–‰ (txt â†’ SQL)         â† API í‚¤ ì„¤ì • í•„ìš”
  3. upload_rules.py ì‹¤í–‰ (SQL â†’ Supabase)        â† API í‚¤ ì„¤ì • í•„ìš”
  4. split_sql.py (ì„ íƒ: SQL ë¶„í• )                 â† ëŒ€ìš©ëŸ‰ ì‹œ í•„ìš”
  5. ê° ë‹¨ê³„ë§ˆë‹¤ .env ì„¤ì • + í„°ë¯¸ë„ ì ‘ê·¼ í•„ìš”
```

#### ì œì•ˆ: Tennis Mate Admin Page + Edge Function

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Tennis Mate - Admin: Tennis Rules ETL                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Step 1: í…ìŠ¤íŠ¸ ì¤€ë¹„                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚  Option A: PDF ì—…ë¡œë“œ â†’ Gemini ìë™ ì¶”ì¶œ               â”‚      â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚      â”‚
â”‚  â”‚  â”‚ [PDF íŒŒì¼ ì„ íƒ] â”‚ â”‚ [í…ìŠ¤íŠ¸ ì¶”ì¶œ ì‹œì‘]            â”‚   â”‚      â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚      â”‚
â”‚  â”‚                                                       â”‚      â”‚
â”‚  â”‚  Option B: í…ìŠ¤íŠ¸ ì§ì ‘ ë¶™ì—¬ë„£ê¸°                         â”‚      â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚      â”‚
â”‚  â”‚  â”‚                                                 â”‚  â”‚      â”‚
â”‚  â”‚  â”‚  (pre-formatted markdown text area)             â”‚  â”‚      â”‚
â”‚  â”‚  â”‚                                                 â”‚  â”‚      â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                                 â”‚
â”‚  Step 2: ì²­í‚¹ ë¯¸ë¦¬ë³´ê¸°                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚  ì†ŒìŠ¤ëª…: [í…Œë‹ˆìŠ¤ê·œì •ì§‘(2020).pdf    ] ì–¸ì–´: [ko â–¼]     â”‚      â”‚
â”‚  â”‚                                                       â”‚      â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚      â”‚
â”‚  â”‚  â”‚ #1  rule_id: "1. ì½”íŠ¸ (THE COURT)"              â”‚  â”‚      â”‚
â”‚  â”‚  â”‚     content: "**1. ì½”íŠ¸** ì½”íŠ¸ëŠ” ì§ì‚¬ê°í˜•ì´..."    â”‚  â”‚      â”‚
â”‚  â”‚  â”‚     length: 1,234 chars                         â”‚  â”‚      â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚      â”‚
â”‚  â”‚  â”‚ #2  rule_id: "2. í¼ë¨¸ë„ŒíŠ¸ í”½ìŠ¤ì²˜"                â”‚  â”‚      â”‚
â”‚  â”‚  â”‚     ...                                         â”‚  â”‚      â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚      â”‚
â”‚  â”‚                                                       â”‚      â”‚
â”‚  â”‚  ì´ 155ê°œ ì¡°í•­ ê°ì§€ë¨  [ì²­í‚¹ ë‹¤ì‹œí•˜ê¸°]                   â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                                 â”‚
â”‚  Step 3: ì„ë² ë”© ìƒì„± & ì—…ë¡œë“œ                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚  [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 67% (104/155)            â”‚      â”‚
â”‚  â”‚                                                       â”‚      â”‚
â”‚  â”‚  â± ì˜ˆìƒ ë‚¨ì€ ì‹œê°„: 51ì´ˆ                                â”‚      â”‚
â”‚  â”‚  âœ… ì„ë² ë”© ìƒì„±: 104ê±´ | âŒ ì‹¤íŒ¨: 0ê±´                   â”‚      â”‚
â”‚  â”‚                                                       â”‚      â”‚
â”‚  â”‚  [ì„ë² ë”© & ì—…ë¡œë“œ ì‹œì‘]     [ì¤‘ë‹¨]                      â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Frontend ETL ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Admin Browser   â”‚     â”‚  Supabase Edge Function       â”‚
â”‚  (Tennis Mate)   â”‚     â”‚  etl-tennis-rules (NEW)       â”‚
â”‚                  â”‚     â”‚                                â”‚
â”‚  1. PDF Upload   â”‚â”€â”€â”€â”€â–¶â”‚  Action: "extract_text"       â”‚
â”‚     ë˜ëŠ” Text   â”‚     â”‚  â†’ Gemini File API í˜¸ì¶œ        â”‚
â”‚     ì§ì ‘ ì…ë ¥    â”‚     â”‚  â†’ ë§ˆí¬ë‹¤ìš´ í…ìŠ¤íŠ¸ ë°˜í™˜         â”‚
â”‚                  â”‚â—€â”€â”€â”€â”€â”‚                                â”‚
â”‚                  â”‚     â”‚                                â”‚
â”‚  2. í…ìŠ¤íŠ¸ í™•ì¸  â”‚â”€â”€â”€â”€â–¶â”‚  Action: "chunk_text"          â”‚
â”‚     & í¸ì§‘      â”‚     â”‚  â†’ ì •ê·œì‹ ì²­í‚¹                  â”‚
â”‚                  â”‚â—€â”€â”€â”€â”€â”‚  â†’ ì¡°í•­ ëª©ë¡ ë°˜í™˜               â”‚
â”‚                  â”‚     â”‚                                â”‚
â”‚  3. chunkë³„ ì²˜ë¦¬ â”‚â”€â”€â”€â”€â–¶â”‚  Action: "process_chunk"       â”‚
â”‚     (ë°˜ë³µ í˜¸ì¶œ)  â”‚     â”‚  â†’ Gemini ì„ë² ë”© ìƒì„±           â”‚
â”‚                  â”‚     â”‚  â†’ metadata êµ¬ì„±                â”‚
â”‚  4. Progress     â”‚â—€â”€â”€â”€â”€â”‚  â†’ Supabase INSERT             â”‚
â”‚     í‘œì‹œ        â”‚     â”‚  â†’ ê²°ê³¼ ë°˜í™˜                    â”‚
â”‚                  â”‚     â”‚                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                              â”‚
     â”‚ Gemini API Key               â”‚ Supabase Service Key
     â”‚ (ì‚¬ìš©ì localStorage)         â”‚ (ì„œë²„ í™˜ê²½ë³€ìˆ˜ - ì•ˆì „)
     â–¼                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Gemini   â”‚              â”‚   Supabase   â”‚
â”‚ API      â”‚              â”‚   Database   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Edge Function API ì„¤ê³„

```
POST /functions/v1/etl-tennis-rules

Action 1: "extract_text"
  Request:  { action: "extract_text", pdfBase64: "...", geminiApiKey: "..." }
  Response: { text: "## í…Œë‹ˆìŠ¤ ë£°...", charCount: 208029 }

Action 2: "chunk_text"
  Request:  { action: "chunk_text", text: "...", sourceName: "...", language: "ko" }
  Response: { chunks: [{rule_id, content, metadata}, ...], count: 155 }

Action 3: "process_chunk"  (frontendì—ì„œ chunkë³„ ë°˜ë³µ í˜¸ì¶œ)
  Request:  { action: "process_chunk", chunk: {...}, geminiApiKey: "..." }
  Response: { success: true, rule_id: "1. ì½”íŠ¸", embeddingDim: 768 }
```

- Frontendì—ì„œ chunk í•˜ë‚˜ì”© `process_chunk` í˜¸ì¶œ â†’ progress bar í‘œì‹œ ê°€ëŠ¥
- chunk ë‹¨ìœ„ ì²˜ë¦¬ë¡œ Edge Function 150ì´ˆ íƒ€ì„ì•„ì›ƒ ë°©ì§€
- ì‹¤íŒ¨í•œ chunkë§Œ ì¬ì‹œë„ ê°€ëŠ¥

#### êµ¬í˜„ ëŒ€ìƒ íŒŒì¼

| íŒŒì¼ | ì‘ì—… | ì„¤ëª… |
|------|------|------|
| `components/AdminETLPage.tsx` | NEW | Admin ETL UI ì»´í¬ë„ŒíŠ¸ |
| `supabase/functions/etl-tennis-rules/index.ts` | NEW | ETL Edge Function |
| `App.tsx` | MODIFY | Admin ë¼ìš°íŠ¸ ì¶”ê°€ |

#### ë³´ì•ˆ ê³ ë ¤ì‚¬í•­
- Gemini API Key: ì‚¬ìš©ì ë¸Œë¼ìš°ì €ì—ì„œë§Œ ê´€ë¦¬ (localStorage)
- Supabase Service Key: Edge Function í™˜ê²½ë³€ìˆ˜ì—ë§Œ ì¡´ì¬ (í”„ë¡ íŠ¸ì—”ë“œ ë…¸ì¶œ ì•ˆ ë¨)
- Admin ì ‘ê·¼ ì œì–´: API key ê²€ì¦ ë˜ëŠ” ë³„ë„ admin ì¸ì¦ í•„ìš”

---

## 1. í˜„ì¬ ìƒíƒœ ë¹„êµ ë¶„ì„ (ê²€í†  ë°˜ì˜ ìˆ˜ì •)

### 1.1 ë‘ ì‹œìŠ¤í…œ ë¹„êµí‘œ

| ì˜ì—­ | Tennis Mate (í˜„ì¬ ì½”ë“œ) | Tennis_Rules_RAG (ì‹¤ì œ ìš´ì˜) | ì°¨ì´ì  |
|------|----------------------|---------------------------|--------|
| **ETL í…ìŠ¤íŠ¸ ì¶”ì¶œ** | PyPDF2 | Gemini Flash API (PDFâ†’txt) | RAG: AI ê¸°ë°˜ ì¶”ì¶œ |
| **ETL Chunking** | ê¸°ë³¸ ì •ê·œì‹ (`ì œNì¡°`, `Article N`) | ë³¼ë“œ ë§ˆí¬ë‹¤ìš´ íŒ¨í„´ + TOC ì œì™¸ | RAGê°€ í›¨ì”¬ ì •êµí•¨ |
| **ETL ìŠ¤í¬ë¦½íŠ¸** | `upload_tennis_rules.py` 1ê°œ | 3ê°œ ë¶„ë¦¬ (`extract`â†’`gen_sql`â†’`upload`) | RAGê°€ ë‹¨ê³„ë³„ ë¶„ë¦¬ |
| **DB ìŠ¤í‚¤ë§ˆ** | `title`, `language`, `chunk_index` | `rule_id`, `metadata` JSONB | **í•„ë“œ êµ¬ì¡° ë‹¤ë¦„** |
| **ì¸ë±ìŠ¤** | IVFFlat (lists=100) | HNSW (cosine_ops) | RAGì˜ HNSWê°€ ë” ë¹ ë¦„ |
| **ì„ë² ë”© ëª¨ë¸** | `text-embedding-004` | `gemini-embedding-001` | **âš ï¸ ë¶ˆì¼ì¹˜ - í†µì¼ í•„ìš”** |
| **ë‹µë³€ ìƒì„± ëª¨ë¸** | `gemini-2.0-flash-exp` | `gemini-flash-latest` | Tennis Mateê°€ ë” ëª…ì‹œì  |
| **RPC í•¨ìˆ˜** | `match_tennis_rules` (language í•„í„°) | `match_tennis_rules` (threshold/countë§Œ) | íŒŒë¼ë¯¸í„° ë‹¤ë¦„ |
| **API í‚¤ ê´€ë¦¬** | í´ë¼ì´ì–¸íŠ¸ â†’ Edge Function body | í´ë¼ì´ì–¸íŠ¸ â†’ body (fallback: env) | RAGê°€ fallback ìˆìŒ |
| **Frontend** | React `TennisRulesChatModal.tsx` | Vanilla HTML `tennis_chat.html` | Tennis Mateê°€ ë” ë°œì „ |

### 1.2 í•µì‹¬ ê²°ë¡  (ê²€í†  ë°˜ì˜ ìˆ˜ì •)

```
Tennis_Rules_RAGì—ì„œ ê°€ì ¸ì˜¬ ê²ƒ:
  âœ… ì‹¤ì œ ETL íŒŒì´í”„ë¼ì¸ (extract_pdf_gemini â†’ gen_sql_from_txt â†’ upload_rules)
  âœ… ì´ë¯¸ ì ì¬ëœ 155ê°œ ì¡°í•­ ë°ì´í„° (Supabaseì— ìš´ì˜ ì¤‘)
  âœ… HNSW ì¸ë±ìŠ¤ ì „ëµ
  âœ… DB ìŠ¤í‚¤ë§ˆ (rule_id, metadata JSONB) â†’ ì´ë¯¸ ìš´ì˜ DBì— ì ìš©ë¨

Tennis Mateì—ì„œ ìœ ì§€í•  ê²ƒ:
  âœ… React ê¸°ë°˜ Chat UI (TennisRulesChatModal.tsx)
  âœ… Supabase Edge Function ì•„í‚¤í…ì²˜
  âœ… API í‚¤ ê´€ë¦¬ ì‹œìŠ¤í…œ (geminiService.ts)

ìˆ˜ì •ì´ í•„ìš”í•œ ê²ƒ:
  âš ï¸ ì„ë² ë”© ëª¨ë¸ í†µì¼: text-embedding-004 â†’ gemini-embedding-001
  âš ï¸ Edge Function: ì‹¤ì œ DB ìŠ¤í‚¤ë§ˆ (rule_id, metadata)ì— ë§ì¶° ìˆ˜ì •
  âš ï¸ match_tennis_rules() RPC: ì‹¤ì œ DB í•¨ìˆ˜ ì‹œê·¸ë‹ˆì²˜ì— ë§ì¶° í˜¸ì¶œ
  âš ï¸ ì˜ë¬¸ PDF ETL: ì •ê·œì‹ íŒ¨í„´ 3ê³³ ìˆ˜ì •
  âš ï¸ metadata ì±„ìš°ê¸°: gen_sql_from_txt.py INSERTë¬¸ ìˆ˜ì • + ê¸°ì¡´ ë°ì´í„° UPDATE
```

---

## 2. ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ ë‹¤ì´ì–´ê·¸ë¨

### 2.1 í†µí•© í›„ ì „ì²´ ì•„í‚¤í…ì²˜ (ê²€í†  ë°˜ì˜ ìˆ˜ì •)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    TENNIS MATE APPLICATION                           â”‚
â”‚                    (React + TypeScript + Vite)                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Players  â”‚  â”‚ Matches  â”‚  â”‚  Feed    â”‚  â”‚      Stats       â”‚    â”‚
â”‚  â”‚   Tab    â”‚  â”‚   Tab    â”‚  â”‚   Tab    â”‚  â”‚       Tab        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                      â”‚              â”‚
â”‚                                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚                                              â”‚   AI Coach     â”‚     â”‚
â”‚                                              â”‚   Section      â”‚     â”‚
â”‚                                              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”‚
â”‚                                              â”‚ [Statsë¶„ì„]    â”‚     â”‚
â”‚                                              â”‚ [ê·œì¹™ì§ˆë¬¸] â—„â”€â”€â”€â”¼â”€â”€â”€â”€ RAG í†µí•© í¬ì¸íŠ¸
â”‚                                              â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                      â”‚              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”‚
â”‚  â”‚                                                   â”‚              â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚              â”‚
â”‚  â”‚  â”‚ StatsAnalysisModal  â”‚  â”‚TennisRulesChatModalâ”‚  â”‚              â”‚
â”‚  â”‚  â”‚ (í†µê³„ ë¶„ì„ AI)       â”‚  â”‚ (ê·œì¹™ Q&A RAG)     â”‚  â”‚              â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚              â”‚
â”‚  â”‚            â”‚                        â”‚              â”‚              â”‚
â”‚  â”‚            â–¼                        â–¼              â”‚              â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚              â”‚
â”‚  â”‚  â”‚           geminiService.ts                  â”‚   â”‚              â”‚
â”‚  â”‚  â”‚  â€¢ getStoredApiKey()                        â”‚   â”‚              â”‚
â”‚  â”‚  â”‚  â€¢ testApiKey()                             â”‚   â”‚              â”‚
â”‚  â”‚  â”‚  â€¢ generateAIAnalysis()                     â”‚   â”‚              â”‚
â”‚  â”‚  â”‚  + searchTennisRules() â—„â”€â”€â”€â”€ ì‹ ê·œ ì¶”ê°€       â”‚   â”‚              â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚              â”‚
â”‚  â”‚                    â”‚                               â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                       â”‚                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚             â–¼                             â”‚
          â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
          â”‚  â”‚  Supabase Edge        â”‚                â”‚
          â”‚  â”‚  Function             â”‚                â”‚
          â”‚  â”‚  search-tennis-rules  â”‚                â”‚
          â”‚  â”‚                       â”‚                â”‚
          â”‚  â”‚  1. Gemini Embedding  â”‚ â—„â”€â”€â”€ gemini-embedding-001 (í†µì¼!)
          â”‚  â”‚  2. pgvector Search   â”‚ â—„â”€â”€â”€ match_tennis_rules()
          â”‚  â”‚  3. Gemini Answer     â”‚ â—„â”€â”€â”€ gemini-2.0-flash
          â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
          â”‚              â”‚                            â”‚
          â”‚              â–¼                            â”‚
          â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
          â”‚  â”‚   Supabase Database   â”‚                â”‚
          â”‚  â”‚   (PostgreSQL)        â”‚                â”‚
          â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                â”‚
          â”‚  â”‚  tennis_rules         â”‚ â—„â”€â”€â”€ HNSW + pgvector (768d)
          â”‚  â”‚  â”œ id (BIGSERIAL)     â”‚                â”‚
          â”‚  â”‚  â”œ source_file (TEXT) â”‚                â”‚
          â”‚  â”‚  â”œ rule_id (TEXT)     â”‚ â—„â”€â”€ ì‹¤ì œ ìš´ì˜ DB ìŠ¤í‚¤ë§ˆ
          â”‚  â”‚  â”œ content (TEXT)     â”‚                â”‚
          â”‚  â”‚  â”œ metadata (JSONB)   â”‚ â—„â”€â”€ í˜„ì¬ NULL â†’ ì±„ìš¸ ì˜ˆì •
          â”‚  â”‚  â”œ embedding (768d)   â”‚                â”‚
          â”‚  â”‚  â”” created_at         â”‚                â”‚
          â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                â”‚
          â”‚  â”‚  players, sessions,   â”‚                â”‚
          â”‚  â”‚  matches              â”‚                â”‚
          â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
          â”‚        SUPABASE CLOUD                     â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 RAG ì§ˆì˜ íë¦„ (Query Flow)

```
ì‚¬ìš©ì                    Frontend                Edge Function           Supabase DB          Gemini API
  â”‚                         â”‚                        â”‚                      â”‚                    â”‚
  â”‚  "ì„œë¸Œ í´íŠ¸ë€?"         â”‚                        â”‚                      â”‚                    â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                        â”‚                      â”‚                    â”‚
  â”‚                         â”‚                        â”‚                      â”‚                    â”‚
  â”‚                         â”‚  ì–¸ì–´ê°ì§€: í•œê¸€â†’'ko'    â”‚                      â”‚                    â”‚
  â”‚                         â”‚  APIí‚¤: localStorage   â”‚                      â”‚                    â”‚
  â”‚                         â”‚                        â”‚                      â”‚                    â”‚
  â”‚                         â”‚  POST /search-tennis-  â”‚                      â”‚                    â”‚
  â”‚                         â”‚  rules                 â”‚                      â”‚                    â”‚
  â”‚                         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                      â”‚                    â”‚
  â”‚                         â”‚  {question, apiKey,    â”‚                      â”‚                    â”‚
  â”‚                         â”‚   language:'ko'}       â”‚                      â”‚                    â”‚
  â”‚                         â”‚                        â”‚                      â”‚                    â”‚
  â”‚                         â”‚                        â”‚  embedContent()      â”‚                    â”‚
  â”‚                         â”‚                        â”‚  gemini-embedding-001â”‚                    â”‚
  â”‚                         â”‚                        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶
  â”‚                         â”‚                        â”‚                      â”‚      [768d vector] â”‚
  â”‚                         â”‚                        â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  â”‚                         â”‚                        â”‚                      â”‚                    â”‚
  â”‚                         â”‚                        â”‚  match_tennis_rules()â”‚                    â”‚
  â”‚                         â”‚                        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                    â”‚
  â”‚                         â”‚                        â”‚                      â”‚  cosine similarity â”‚
  â”‚                         â”‚                        â”‚   Top 5 ê·œì¹™ ë°˜í™˜     â”‚  HNSW search       â”‚
  â”‚                         â”‚                        â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                    â”‚
  â”‚                         â”‚                        â”‚                      â”‚                    â”‚
  â”‚                         â”‚                        â”‚  generateContent()   â”‚                    â”‚
  â”‚                         â”‚                        â”‚  gemini-2.0-flash    â”‚                    â”‚
  â”‚                         â”‚                        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶
  â”‚                         â”‚                        â”‚                      â”‚       [AI ë‹µë³€]    â”‚
  â”‚                         â”‚                        â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  â”‚                         â”‚                        â”‚                      â”‚                    â”‚
  â”‚                         â”‚  {answer, sources,     â”‚                      â”‚                    â”‚
  â”‚                         â”‚   rule_id, metadata}   â”‚                      â”‚                    â”‚
  â”‚                         â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                      â”‚                    â”‚
  â”‚                         â”‚                        â”‚                      â”‚                    â”‚
  â”‚  ë‹µë³€ + ì¶œì²˜ í‘œì‹œ        â”‚                        â”‚                      â”‚                    â”‚
  â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                        â”‚                      â”‚                    â”‚
  â”‚                         â”‚                        â”‚                      â”‚                    â”‚
```

### 2.3 ETL ë°ì´í„° íë¦„ (ì‹¤ì œ íŒŒì´í”„ë¼ì¸ ë°˜ì˜)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 ETL PIPELINE (ì‹¤ì œ ê²€ì¦ëœ íë¦„)                     â”‚
â”‚              (ì¼íšŒì„± / ê·œì¹™ ì—…ë°ì´íŠ¸ ì‹œ ì‹¤í–‰)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  STEP 1: Gemini AI í…ìŠ¤íŠ¸ ì¶”ì¶œ (extract_pdf_gemini.py)             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ PDF ë¬¸ì„œ          â”‚â”€â”€â”€â”€â”€â–¶â”‚ Gemini Flash API             â”‚      â”‚
â”‚  â”‚ (ITF EN / KTA KO) â”‚      â”‚ â€¢ PDF íŒŒì¼ ì—…ë¡œë“œ             â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚ â€¢ "ì›ë³¸ ìœ ì§€í•˜ë©° í…ìŠ¤íŠ¸ ì¶”ì¶œ"  â”‚      â”‚
â”‚                            â”‚ â€¢ ë§ˆí¬ë‹¤ìš´ í˜•ì‹ìœ¼ë¡œ ì¶œë ¥        â”‚      â”‚
â”‚                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                        â”‚                         â”‚
â”‚                               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚                               â”‚ full_rules_text   â”‚              â”‚
â”‚                               â”‚ .txt (208KB)      â”‚              â”‚
â”‚                               â”‚ ë§ˆí¬ë‹¤ìš´ í˜•ì‹       â”‚              â”‚
â”‚                               â”‚ **1. ì½”íŠ¸** ...    â”‚              â”‚
â”‚                               â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                        â”‚                         â”‚
â”‚  STEP 2: ì¡°í•­ë³„ ì²­í‚¹ + ì„ë² ë”© (gen_sql_from_txt.py)                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  1. TOC ìë™ ê±´ë„ˆë›°ê¸° (start_marker íƒìƒ‰)                  â”‚   â”‚
â”‚  â”‚  2. ë³¼ë“œ ë§ˆí¬ë‹¤ìš´ íŒ¨í„´ìœ¼ë¡œ ë¶„í• :                             â”‚   â”‚
â”‚  â”‚     **N. ì œëª©** â†’ ì£¼ìš” ê·œì¹™                                â”‚   â”‚
â”‚  â”‚     **a. ì œëª©** â†’ í•˜ìœ„ ì„¹ì…˜                                â”‚   â”‚
â”‚  â”‚     **I. ì œëª©** â†’ ë¶€ë¡ (ë¡œë§ˆ ìˆ«ì)                          â”‚   â”‚
â”‚  â”‚  3. ê° chunkì— gemini-embedding-001 ì„ë² ë”© ìƒì„± (768d)      â”‚   â”‚
â”‚  â”‚  4. L2 ì •ê·œí™” ì ìš©                                         â”‚   â”‚
â”‚  â”‚  5. SQL INSERTë¬¸ìœ¼ë¡œ ì¶œë ¥                                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â”‚                                   â”‚
â”‚                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚                     â”‚ insert_rules.sql  â”‚                        â”‚
â”‚                     â”‚ (2.8MB, 155ê±´)    â”‚                        â”‚
â”‚                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚                              â”‚                                   â”‚
â”‚  STEP 3: Supabase ì—…ë¡œë“œ (upload_rules.py)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  â€¢ SQL íŒŒì¼ íŒŒì‹± (ì •ê·œì‹ìœ¼ë¡œ VALUES ì¶”ì¶œ)                    â”‚   â”‚
â”‚  â”‚  â€¢ ë°°ì¹˜ ì‚¬ì´ì¦ˆ: 10                                         â”‚   â”‚
â”‚  â”‚  â€¢ Supabase client INSERT                                 â”‚   â”‚
â”‚  â”‚  â€¢ ì‹¤íŒ¨ ì‹œ ê±´ë³„ ì¬ì‹œë„                                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. í†µí•© ë‹¨ê³„ë³„ ê³„íš (ê²€í†  ë°˜ì˜ ìˆ˜ì •)

### Phase 1: Edge Function ìˆ˜ì • (ì‹¤ì œ DBì— ë§ì¶¤) - ìµœìš°ì„ 

```
ëª©í‘œ: Tennis Mateì˜ Edge Functionì„ ì‹¤ì œ Supabase DB ìŠ¤í‚¤ë§ˆì— ë§ì¶”ê¸°

í˜„ì¬ ë¬¸ì œ:                              ìˆ˜ì • í›„:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ search-tennis-rules/       â”‚        â”‚ search-tennis-rules/               â”‚
â”‚ index.ts                   â”‚        â”‚ index.ts                           â”‚
â”‚                            â”‚        â”‚                                    â”‚
â”‚ âŒ text-embedding-004      â”‚  â”€â”€â–¶   â”‚ âœ… gemini-embedding-001        FIX â”‚
â”‚ âŒ title ì»¬ëŸ¼ ì°¸ì¡°          â”‚        â”‚ âœ… rule_id ì»¬ëŸ¼ ì°¸ì¡°           FIX â”‚
â”‚ âŒ language í•„í„° ì‚¬ìš©       â”‚        â”‚ âœ… metadataì—ì„œ language ì°¸ì¡°  FIX â”‚
â”‚ â€¢ ê³ ì • threshold 0.5       â”‚        â”‚ â€¢ ê°€ë³€ threshold (param)     UPG â”‚
â”‚ â€¢ ê³ ì • match_count 5       â”‚        â”‚ â€¢ ê°€ë³€ match_count (param)   UPG â”‚
â”‚                            â”‚        â”‚ â€¢ metadata ë°˜í™˜              NEW â”‚
â”‚                            â”‚        â”‚ â€¢ í•œ/ì˜ í”„ë¡¬í”„íŠ¸ ë¶„ë¦¬         NEW â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**íŒŒì¼ ë³€ê²½ ëª©ë¡:**
| íŒŒì¼ | ì‘ì—… |
|------|------|
| `supabase/functions/search-tennis-rules/index.ts` | ì„ë² ë”© ëª¨ë¸ ë³€ê²½ + DB ìŠ¤í‚¤ë§ˆ ë§ì¶¤ |

---

### Phase 2: metadata ì±„ìš°ê¸°

```
ëª©í‘œ: ê¸°ì¡´ 155ê°œ ë ˆì½”ë“œì˜ metadata NULL â†’ ìœ ìš©í•œ ê°’ìœ¼ë¡œ ì±„ìš°ê¸°

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ í˜„ì¬ ìƒíƒœ            â”‚          â”‚ ìˆ˜ì • í›„                      â”‚
â”‚                     â”‚          â”‚                             â”‚
â”‚ metadata: NULL      â”‚   â”€â”€â–¶    â”‚ metadata: {                 â”‚
â”‚ (ì „ì²´ 155ê±´)         â”‚          â”‚   "language": "ko",         â”‚
â”‚                     â”‚          â”‚   "source_version":         â”‚
â”‚                     â”‚          â”‚     "KTA 2020.11.20",       â”‚
â”‚                     â”‚          â”‚   "section_type": "rule",   â”‚
â”‚                     â”‚          â”‚   "original_len": 1234      â”‚
â”‚                     â”‚          â”‚ }                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ì‘ì—…:** Supabase SQL Editorì—ì„œ UPDATE ì¿¼ë¦¬ 1íšŒ ì‹¤í–‰

---

### Phase 3: ì˜ë¬¸ PDF ETL ì •ê·œì‹ ìˆ˜ì •

```
ëª©í‘œ: gen_sql_from_txt.pyê°€ ì˜ë¬¸ PDF í…ìŠ¤íŠ¸ë„ ì²˜ë¦¬í•  ìˆ˜ ìˆë„ë¡ ìˆ˜ì •

ìˆ˜ì • ëŒ€ìƒ (gen_sql_from_txt.py):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. start_marker (line 26):                                       â”‚
â”‚    í˜„ì¬: r"(\*\*1\.\s*ì½”íŠ¸|\*\*ITF\s*í…Œë‹ˆìŠ¤\s*ë£°\*\*)"            â”‚
â”‚    ìˆ˜ì •: r"(\*\*1\.\s*(?:ì½”íŠ¸|THE COURT|Court)                    â”‚
â”‚           |\*\*(?:ITF\s*í…Œë‹ˆìŠ¤\s*ë£°|ITF\s*Rules)\*\*)"            â”‚
â”‚                                                                  â”‚
â”‚ 2. body_split_pattern (line 42-45):                              â”‚
â”‚    negative lookahead ì¶”ê°€: Page|Contents|Table of Contents      â”‚
â”‚    ì„ íƒì : Rule\s*\d+ íŒ¨í„´ ì¶”ê°€ (Gemini ì¶œë ¥ì— ë”°ë¼)              â”‚
â”‚                                                                  â”‚
â”‚ 3. INSERTë¬¸ (line 133):                                          â”‚
â”‚    metadata ì»¬ëŸ¼ ì¶”ê°€                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ê¶Œì¥ ìˆœì„œ:
  Step 1: extract_pdf_gemini.pyë¡œ ì˜ë¬¸ PDF DRY RUN
  Step 2: Gemini ì¶œë ¥ í˜•ì‹ í™•ì¸
  Step 3: gen_sql_from_txt.py ì •ê·œì‹ ì¡°ì •
  Step 4: ì˜ë¬¸ ë°ì´í„° ìƒì„± + ì—…ë¡œë“œ
```

---

### Phase 4: Frontend Chat UI ê°•í™”

```
ëª©í‘œ: TennisRulesChatModalì„ ì‹¤ì œ DB ìŠ¤í‚¤ë§ˆì— ë§ì¶”ê³  UX ê°œì„ 

í˜„ì¬ UI êµ¬ì¡°:                           í†µí•© í›„ UI êµ¬ì¡°:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—   â”‚           â”‚ â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•— â”‚
â”‚ â•‘ Ask Tennis Questionsâ•‘   â”‚           â”‚ â•‘  í…Œë‹ˆìŠ¤ ê·œì¹™ Q&A             â•‘ â”‚
â”‚ â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚           â”‚ â•‘    [KO] [EN] ì–¸ì–´ í† ê¸€  NEW â•‘ â”‚
â”‚                          â”‚           â”‚ â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚           â”‚                                  â”‚
â”‚ â”‚ ì±„íŒ… ë©”ì‹œì§€ ì˜ì—­    â”‚   â”‚           â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚                    â”‚   â”‚           â”‚ â”‚ ì±„íŒ… ë©”ì‹œì§€ ì˜ì—­              â”‚ â”‚
â”‚ â”‚ User: ì§ˆë¬¸         â”‚   â”‚           â”‚ â”‚                              â”‚ â”‚
â”‚ â”‚ Bot: ë‹µë³€          â”‚   â”‚   â”€â”€â–¶     â”‚ â”‚ User: ì§ˆë¬¸                   â”‚ â”‚
â”‚ â”‚   ğŸ“š Sources:      â”‚   â”‚           â”‚ â”‚ Bot: ë‹µë³€                    â”‚ â”‚
â”‚ â”‚   â€¢ Article 5 (87%)â”‚   â”‚           â”‚ â”‚   ğŸ“š Sources:                â”‚ â”‚
â”‚ â”‚                    â”‚   â”‚           â”‚ â”‚   â€¢ Rule 16 ì„œë¸Œí´íŠ¸ (87%)   â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚           â”‚ â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚ â”‚
â”‚                          â”‚           â”‚ â”‚   â”‚ ğŸ“– ì „ì²´ ì¡°í•­ ë³´ê¸°  â”‚ NEW â”‚ â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚           â”‚ â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚ â”‚
â”‚ â”‚ [ì…ë ¥] [ì „ì†¡]       â”‚   â”‚           â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚           â”‚                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
                                       â”‚ â”‚ ğŸ’¡ ì¶”ì²œ ì§ˆë¬¸:            NEW â”‚ â”‚
                                       â”‚ â”‚ "ì„œë¸Œ ê·œì¹™ì€?" "íƒ€ì´ë¸Œë ˆì´í¬?" â”‚ â”‚
                                       â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
                                       â”‚                                  â”‚
                                       â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
                                       â”‚ â”‚ [ì…ë ¥]              [ì „ì†¡]   â”‚ â”‚
                                       â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
                                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**íŒŒì¼ ë³€ê²½ ëª©ë¡:**
| íŒŒì¼ | ì‘ì—… |
|------|------|
| `components/TennisRulesChatModal.tsx` | rule_id ê¸°ë°˜ ì¶œì²˜ í‘œì‹œ + UI ê°•í™” |
| `services/geminiService.ts` | `searchTennisRules()` í•¨ìˆ˜ ì¶”ê°€ |
| `types.ts` | RAG ê´€ë ¨ íƒ€ì… ì¶”ê°€ |
| `constants.ts` | RAG ê´€ë ¨ ìƒìˆ˜ ì¶”ê°€ |

---

### Phase 5: Frontend ETL Admin Page (ì‹ ê·œ)

ê²€í†  4ì—ì„œ ì œì•ˆí•œ Admin Page + Edge Function êµ¬í˜„.
ìƒì„¸ ì™€ì´ì–´í”„ë ˆì„ ë° API ì„¤ê³„ëŠ” [ê²€í†  4](#ê²€í† -4-frontend-etl-plan) ì°¸ì¡°.

**íŒŒì¼ ë³€ê²½ ëª©ë¡:**
| íŒŒì¼ | ì‘ì—… |
|------|------|
| `components/AdminETLPage.tsx` | NEW - Admin ETL UI |
| `supabase/functions/etl-tennis-rules/index.ts` | NEW - ETL Edge Function |
| `App.tsx` | MODIFY - Admin ë¼ìš°íŠ¸ ì¶”ê°€ |

---

## 4. íŒŒì¼ë³„ ë³€ê²½ ê³„íš ìš”ì•½

### 4.1 ë³€ê²½ íŒŒì¼ ëª©ë¡ (ê²€í†  ë°˜ì˜ ìˆ˜ì •)

```
tennis-mate/
â”œâ”€â”€ supabase/
â”‚   â””â”€â”€ functions/
â”‚       â”œâ”€â”€ search-tennis-rules/
â”‚       â”‚   â””â”€â”€ index.ts                           â—„â”€â”€ [FIX] ì„ë² ë”© ëª¨ë¸ + DB ìŠ¤í‚¤ë§ˆ ë§ì¶¤
â”‚       â””â”€â”€ etl-tennis-rules/
â”‚           â””â”€â”€ index.ts                           â—„â”€â”€ [NEW] Frontend ETL Edge Function
â”‚
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ TennisRulesChatModal.tsx                   â—„â”€â”€ [MODIFY] rule_id ê¸°ë°˜ ì¶œì²˜ + UI ê°•í™”
â”‚   â””â”€â”€ AdminETLPage.tsx                           â—„â”€â”€ [NEW] Admin ETL í˜ì´ì§€
â”‚
â”œâ”€â”€ services/
â”‚   â””â”€â”€ geminiService.ts                           â—„â”€â”€ [MODIFY] searchTennisRules() ì¶”ê°€
â”‚
â”œâ”€â”€ types.ts                                       â—„â”€â”€ [MODIFY] RAG íƒ€ì… ì¶”ê°€
â”œâ”€â”€ constants.ts                                   â—„â”€â”€ [MODIFY] RAG ìƒìˆ˜ ì¶”ê°€
â””â”€â”€ App.tsx                                        â—„â”€â”€ [MODIFY] Admin ë¼ìš°íŠ¸ ì¶”ê°€
```

### 4.2 ì˜ì¡´ì„± ê´€ê³„ ë° ì‹¤í–‰ ìˆœì„œ

```
Phase 1 (Edge Function FIX) â”€â”€â”€â”€â”€â”€â”
  âš ï¸ ìµœìš°ì„  - í˜„ì¬ ë™ì‘ ì•ˆ ë  ìˆ˜ ìˆìŒ  â”‚
                                   â”œâ”€â”€â–¶ ê²€ì¦: RAG ì§ˆì˜ ì •ìƒ ë™ì‘ í™•ì¸
Phase 2 (metadata UPDATE) â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  SQL 1íšŒ ì‹¤í–‰

Phase 3 (ì˜ë¬¸ PDF ETL) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ ì˜ë¬¸ ë°ì´í„° ì ì¬

Phase 4 (Frontend UI) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ Chat UI ê°œì„ 

Phase 5 (Admin ETL Page) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ í–¥í›„ í¸ë¦¬í•œ ë°ì´í„° ê´€ë¦¬

ì‹¤í–‰ ìˆœì„œ:
  Phase 1 + 2 (ì¦‰ì‹œ, ë³‘ë ¬) â†’ Phase 3 (ì˜ë¬¸ PDF) â†’ Phase 4 (UI) â†’ Phase 5 (Admin)
```

---

## 5. ë¦¬ìŠ¤í¬ ë° ê³ ë ¤ì‚¬í•­

### 5.1 ë¦¬ìŠ¤í¬ ë§¤íŠ¸ë¦­ìŠ¤ (ê²€í†  ë°˜ì˜ ìˆ˜ì •)

```
ì˜í–¥ë„ â–²
       â”‚
  ë†’ìŒ  â”‚  â“µ ì„ë² ë”© ëª¨ë¸ ë¶ˆì¼ì¹˜      â“¶ DB ìŠ¤í‚¤ë§ˆ ë¶ˆì¼ì¹˜
       â”‚     (ë°œê²¬ë¨, í•´ê²° í•„ìš”)       (ë°œê²¬ë¨, í•´ê²° í•„ìš”)
       â”‚
  ì¤‘ê°„  â”‚  â“· ì˜ë¬¸ PDF ì •ê·œì‹ ë¯¸ìŠ¤ë§¤ì¹˜  â“¸ API í• ë‹¹ëŸ‰ ì´ˆê³¼
       â”‚
  ë‚®ìŒ  â”‚  â“¹ UI ë Œë”ë§ ì°¨ì´          â“º Chunking í’ˆì§ˆ ì €í•˜
       â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶
          ë‚®ìŒ          ì¤‘ê°„          ë†’ìŒ    ë°œìƒí™•ë¥ 

ëŒ€ì‘ ë°©ì•ˆ:
  â“µ ì„ë² ë”© ëª¨ë¸ ë¶ˆì¼ì¹˜ â†’ Edge Functionì—ì„œ gemini-embedding-001ë¡œ ë³€ê²½ (Phase 1)
  â“¶ DB ìŠ¤í‚¤ë§ˆ ë¶ˆì¼ì¹˜ â†’ Edge Functionì„ ì‹¤ì œ DB ìŠ¤í‚¤ë§ˆì— ë§ì¶° ìˆ˜ì • (Phase 1)
  â“· ì˜ë¬¸ ì •ê·œì‹ â†’ DRY RUNìœ¼ë¡œ Gemini ì¶œë ¥ í˜•ì‹ í™•ì¸ í›„ ì¡°ì • (Phase 3)
  â“¸ API í• ë‹¹ëŸ‰ â†’ ì¬ì ì¬ ì‹œ rate limit ì¤€ìˆ˜ / ë°°ì¹˜ ì²˜ë¦¬
  â“¹ UI ë Œë”ë§ â†’ ê¸°ì¡´ React ì»´í¬ë„ŒíŠ¸ ì ì§„ì  ìˆ˜ì •
  â“º Chunking í’ˆì§ˆ â†’ DRY_RUN ëª¨ë“œë¡œ ì‚¬ì „ ê²€ì¦
```

### 5.2 í˜¸í™˜ì„± ì „ëµ

```
Edge Function API í•˜ìœ„ í˜¸í™˜:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ ê¸°ì¡´ ìš”ì²­ (v1)        â”‚     â”‚ í™•ì¥ ìš”ì²­ (v2)                â”‚
  â”‚ {                    â”‚     â”‚ {                            â”‚
  â”‚   question: "...",   â”‚     â”‚   question: "...",           â”‚
  â”‚   geminiApiKey: "..",â”‚     â”‚   geminiApiKey: "..",        â”‚
  â”‚   language: "ko"     â”‚     â”‚   language: "ko",            â”‚
  â”‚ }                    â”‚     â”‚   matchCount: 10,    â† ì˜µì…˜  â”‚
  â”‚                      â”‚     â”‚   matchThreshold: 0.3 â† ì˜µì…˜ â”‚
  â”‚  âœ… ê·¸ëŒ€ë¡œ ë™ì‘       â”‚     â”‚ }                            â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚  âœ… í•˜ìœ„ í˜¸í™˜                 â”‚
                               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6. í…ŒìŠ¤íŠ¸ ê³„íš

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         í…ŒìŠ¤íŠ¸ ì²´í¬ë¦¬ìŠ¤íŠ¸                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â˜ Phase 1: Edge Function ìˆ˜ì •                                  â”‚
â”‚    â˜ ì„ë² ë”© ëª¨ë¸ gemini-embedding-001 ì‚¬ìš© í™•ì¸                   â”‚
â”‚    â˜ rule_id í•„ë“œ ì •ìƒ ë°˜í™˜ í™•ì¸                                  â”‚
â”‚    â˜ metadata í•„ë“œ ì •ìƒ ë°˜í™˜ í™•ì¸                                 â”‚
â”‚    â˜ í•œê¸€ ì§ˆë¬¸ â†’ ì •í™•í•œ ë‹µë³€ + ì¶œì²˜                               â”‚
â”‚    â˜ ê¸°ì¡´ API (v1) í•˜ìœ„ í˜¸í™˜ì„±                                   â”‚
â”‚    â˜ CORS ì •ìƒ ë™ì‘                                              â”‚
â”‚                                                                 â”‚
â”‚  â˜ Phase 2: metadata ì—…ë°ì´íŠ¸                                    â”‚
â”‚    â˜ 155ê±´ ì „ì²´ metadata NOT NULL í™•ì¸                           â”‚
â”‚    â˜ section_type ë¶„ë¥˜ ì •í™•ì„±                                    â”‚
â”‚    â˜ Edge Functionì—ì„œ metadata ë°˜í™˜ í™•ì¸                        â”‚
â”‚                                                                 â”‚
â”‚  â˜ Phase 3: ì˜ë¬¸ PDF ETL                                        â”‚
â”‚    â˜ extract_pdf_gemini.py DRY RUN ì„±ê³µ                         â”‚
â”‚    â˜ ì˜ë¬¸ í…ìŠ¤íŠ¸ ì²­í‚¹ ê²°ê³¼ ê²€ì¦ (ì¡°í•­ ìˆ˜)                         â”‚
â”‚    â˜ ì˜ë¬¸ ì„ë² ë”© ìƒì„± í™•ì¸ (768ì°¨ì›)                              â”‚
â”‚    â˜ Supabase ì—…ë¡œë“œ ê²€ì¦                                        â”‚
â”‚    â˜ ì˜ë¬¸ ì§ˆë¬¸ â†’ ì˜ë¬¸ ë‹µë³€ í™•ì¸                                   â”‚
â”‚                                                                 â”‚
â”‚  â˜ Phase 4: Frontend UI                                         â”‚
â”‚    â˜ ì±„íŒ… ë©”ì‹œì§€ í‘œì‹œ ì •ìƒ                                        â”‚
â”‚    â˜ ì¶œì²˜ í‘œì‹œ (rule_id í¬í•¨)                                    â”‚
â”‚    â˜ ì¶”ì²œ ì§ˆë¬¸ ë™ì‘                                              â”‚
â”‚    â˜ ì—ëŸ¬ ìƒíƒœ í‘œì‹œ                                              â”‚
â”‚    â˜ ëª¨ë°”ì¼ ë°˜ì‘í˜• í™•ì¸                                           â”‚
â”‚                                                                 â”‚
â”‚  â˜ Phase 5: Admin ETL Page                                      â”‚
â”‚    â˜ í…ìŠ¤íŠ¸ ë¶™ì—¬ë„£ê¸° â†’ ì²­í‚¹ ë¯¸ë¦¬ë³´ê¸°                              â”‚
â”‚    â˜ ì„ë² ë”© ìƒì„± progress í‘œì‹œ                                    â”‚
â”‚    â˜ Supabase ì—…ë¡œë“œ ì„±ê³µ                                        â”‚
â”‚    â˜ ì—ëŸ¬ ì‹œ ì¬ì‹œë„ ë™ì‘                                          â”‚
â”‚                                                                 â”‚
â”‚  â˜ í†µí•© E2E                                                     â”‚
â”‚    â˜ "ì„œë¸Œ í´íŠ¸ëŠ”?" â†’ ì •í™•í•œ ë‹µë³€ + 16. ì„œë¹„ìŠ¤ ì¶œì²˜               â”‚
â”‚    â˜ "What is a let?" â†’ ì˜ë¬¸ ë‹µë³€ + ì˜ë¬¸ ì¶œì²˜                    â”‚
â”‚    â˜ ê¸°ì¡´ Stats ë¶„ì„ ê¸°ëŠ¥ ì •ìƒ ë™ì‘ (íšŒê·€ í…ŒìŠ¤íŠ¸)                  â”‚
â”‚    â˜ API í‚¤ ì—†ì„ ë•Œ ì ì ˆí•œ ì—ëŸ¬ ë©”ì‹œì§€                             â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 7. ìš”ì•½: ì‘ì—… ìˆœì„œ ë° ì²´í¬ë¦¬ìŠ¤íŠ¸

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  #  â”‚ Phase                â”‚ ì£¼ìš” ì‘ì—…                  â”‚ íŒŒì¼ ìˆ˜   â”‚
â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1  â”‚ Edge Function FIX    â”‚ ì„ë² ë”© ëª¨ë¸ í†µì¼ +         â”‚    1     â”‚
â”‚     â”‚ âš ï¸ ìµœìš°ì„              â”‚ DB ìŠ¤í‚¤ë§ˆ ë§ì¶¤             â”‚          â”‚
â”‚  2  â”‚ metadata UPDATE      â”‚ SQL UPDATE 1íšŒ ì‹¤í–‰        â”‚    -     â”‚
â”‚  3  â”‚ ì˜ë¬¸ PDF ETL         â”‚ ì •ê·œì‹ ìˆ˜ì • + DRY RUN      â”‚    2     â”‚
â”‚  4  â”‚ Frontend UI ê°•í™”     â”‚ rule_id ì¶œì²˜, ì¶”ì²œì§ˆë¬¸     â”‚    4     â”‚
â”‚  5  â”‚ Admin ETL Page       â”‚ Frontend ETL UI + Edge Fn â”‚    3     â”‚
â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚     â”‚ í•©ê³„                 â”‚                           â”‚  ~10 íŒŒì¼ â”‚
â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

> **ì°¸ê³ **: ì´ ë¬¸ì„œëŠ” ì½”ë”© ê³„íšì„œì…ë‹ˆë‹¤. ì‹¤ì œ ì½”ë“œ ë³€ê²½ì€ í¬í•¨ë˜ì–´ ìˆì§€ ì•ŠìŠµë‹ˆë‹¤.
> Phaseë³„ êµ¬í˜„ ì‹œ ì´ ê³„íšì„œë¥¼ ì°¸ì¡°í•˜ì—¬ ì§„í–‰í•©ë‹ˆë‹¤.
>
> **ê²€í†  ì´ë ¥**:
> - 2026-02-07: ì´ˆì•ˆ ì‘ì„± (ì‹œìŠ¤í…œ ë¹„êµ + 6 Phase ê³„íš)
> - 2026-02-08: Tennis_Rules_RAG ë ˆí¬ í´ë¡  ë¶„ì„ í›„ 4ê°€ì§€ ê²€í†  ê²°ê³¼ ë°˜ì˜
>   - ì„ë² ë”© ëª¨ë¸ ë¶ˆì¼ì¹˜ ë°œê²¬ (`gemini-embedding-001` vs `text-embedding-004`)
>   - ì‹¤ì œ DB ìŠ¤í‚¤ë§ˆì™€ ì½”ë“œ ê°„ ë¶ˆì¼ì¹˜ ë°œê²¬
>   - ì‹¤ì œ ETL íŒŒì´í”„ë¼ì¸ í™•ì¸ (3ë‹¨ê³„ ë¶„ë¦¬)
>   - ì˜ë¬¸ PDF í˜¸í™˜ì„± ë¶„ì„ + metadata ìˆ˜ì • ë°©ì•ˆ + Frontend ETL Plan ì¶”ê°€
